<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Career Portal - Submit Resume</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Flowbite (optional) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.js"></script>

  <style>
    body {
      background: linear-gradient(135deg, #eef2ff, #e0f2fe);
      animation: fadeIn 0.9s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .upload-box:hover { transform: scale(1.02); transition: 0.18s; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">

  <div class="bg-white max-w-lg w-full p-8 rounded-2xl shadow-2xl border">
    <div class="flex justify-center mb-4">
      <img src="https://upload.wikimedia.org/wikipedia/commons/a/a7/React-icon.svg" class="h-14 opacity-70" alt="">
    </div>

    <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">Submit Your Resume</h2>

    <!-- IMPORTANT: replace action with your n8n webhook URL -->
    <form id="resumeForm" action="Your n8n webhook URL Goes Here" method="POST" enctype="multipart/form-data" class="space-y-5">

      <div>
        <label class="block text-gray-700 font-medium mb-1">Full Name</label>
        <input type="text" name="candidate_name" required placeholder="Enter your full name" class="w-full p-3 border rounded-xl shadow focus:ring-2 focus:ring-indigo-500" />
      </div>

      <div>
        <label class="block text-gray-700 font-medium mb-1">Email Address</label>
        <input type="email" name="candidate_email" required placeholder="Enter your email" class="w-full p-3 border rounded-xl shadow focus:ring-2 focus:ring-indigo-500" />
      </div>

      <div>
        <label class="block text-gray-700 font-medium mb-1">Job Position</label>
        <select name="job_id" id="jobSelect" required class="w-full p-3 border rounded-xl shadow bg-white focus:ring-2 focus:ring-indigo-500">
          <option value="">Loading job roles...</option>
        </select>
      </div>

      <label class="block text-gray-700 font-medium mb-1">Upload Resume</label>
      <div id="dropArea" class="upload-box border-2 border-dashed rounded-xl p-6 text-center bg-gray-50 cursor-pointer transition hover:bg-gray-100 hover:border-indigo-500">
        <input type="file" id="resumeInput" name="resume" accept=".pdf,.docx" required class="hidden" />

        <div id="uploadIcon">
          <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto mb-2 w-12 h-12 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-6l-4-4m0 0l-4 4m4-4v12" />
          </svg>
          <p class="text-gray-600 font-medium">Click or drag file here</p>
        </div>

        <div id="uploadLoading" class="hidden">
          <div class="flex justify-center mb-2">
            <div class="w-6 h-6 border-4 border-indigo-400 border-t-transparent rounded-full animate-spin"></div>
          </div>
          <p class="text-indigo-600 font-medium">Uploadingâ€¦</p>
        </div>

        <div id="uploadSuccess" class="hidden">
          <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto mb-2 w-12 h-12 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
          </svg>
          <p class="text-green-600 font-medium">File ready!</p>
        </div>

        <p id="fileName" class="mt-3 text-gray-700 font-semibold hidden"></p>
      </div>

      <button type="submit" class="w-full py-3 bg-indigo-600 text-white font-semibold rounded-xl shadow hover:bg-indigo-700 transition">Submit Application</button>

      <p id="successMsg" class="hidden text-green-600 text-center font-semibold mt-2">âœ” Your resume has been submitted!</p>
    </form>
  </div>

  <!-- ========== SCRIPT ========== -->
  <script>
    // ---------- REPLACE this with your CSV export link (no newline) ----------
    const sheetURL = "Google_Sheet_CSV_Export_Link_Here";

    // safer CSV parse (handle commas in later columns)
    function parseCsvLine(line) {
      const parts = line.split(',');
      if (parts.length < 2) return [null, null];
      const job_id = parts[0].trim();
      const job_title = parts.slice(1).join(',').trim();
      return [job_id, job_title];
    }

    async function loadJobs() {
      const select = document.getElementById("jobSelect");
      select.innerHTML = `<option value="">Loading job roles...</option>`;

      try {
        console.log("Fetching jobs from:", sheetURL);
        const res = await fetch(sheetURL);
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.text();
        console.log("CSV content preview:", data.slice(0, 1000));

        const rows = data.split(/\r?\n/).filter(r => r.trim().length > 0);
        if (rows.length && rows[0].toLowerCase().includes('job id')) rows.shift(); // drop header

        select.innerHTML = `<option value="">-- Select Job Role --</option>`;
        for (const row of rows) {
          const [job_id, job_title] = parseCsvLine(row);
          if (!job_id || !job_title) continue;
          const option = document.createElement("option");
          option.value = job_id;
          option.textContent = `${job_id} â€” ${job_title}`;
          select.appendChild(option);
        }

        if (select.options.length === 1) select.innerHTML = `<option value="">No job roles found</option>`;
      } catch (err) {
        console.error("Job load error:", err);
        select.innerHTML = `<option value="">Error loading roles</option>`;
      }
    }

    loadJobs();

    // ---------- Upload UI logic ----------
    const dropArea = document.getElementById("dropArea");
    const resumeInput = document.getElementById("resumeInput");
    const fileName = document.getElementById("fileName");
    const uploadIcon = document.getElementById("uploadIcon");
    const uploadLoading = document.getElementById("uploadLoading");
    const uploadSuccess = document.getElementById("uploadSuccess");
    const MAX_SIZE_MB = 5;

    dropArea.addEventListener("click", () => resumeInput.click());
    resumeInput.addEventListener("change", handleFileSelect);

    dropArea.addEventListener("dragover", e => { e.preventDefault(); dropArea.classList.add("bg-indigo-50", "border-indigo-500"); });
    dropArea.addEventListener("dragleave", () => { dropArea.classList.remove("bg-indigo-50", "border-indigo-500"); });
    dropArea.addEventListener("drop", e => {
      e.preventDefault();
      dropArea.classList.remove("bg-indigo-50", "border-indigo-500");
      if (e.dataTransfer.files.length) {
        resumeInput.files = e.dataTransfer.files;
        handleFileSelect();
      }
    });

    function handleFileSelect() {
      const file = resumeInput.files[0];
      if (!file) return;
      if (file.size > MAX_SIZE_MB * 1024 * 1024) {
        alert(`File too large! Max allowed: ${MAX_SIZE_MB} MB`);
        resumeInput.value = "";
        return;
      }
      uploadIcon.classList.add("hidden");
      uploadSuccess.classList.add("hidden");
      uploadLoading.classList.remove("hidden");
      fileName.classList.add("hidden");

      setTimeout(() => {
        uploadLoading.classList.add("hidden");
        uploadSuccess.classList.remove("hidden");
        fileName.textContent = `ðŸ“„ ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
        fileName.classList.remove("hidden");
      }, 700);
    }

    // success message after submit
    const form = document.getElementById("resumeForm");
    const successMsg = document.getElementById("successMsg");
    form.addEventListener("submit", () => { successMsg.classList.remove("hidden"); });
  </script>
</body>
</html>
